<!--<!DOCTYPE html>-->
<!--<html lang="ru">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>Заполнение заказа</title>-->
<!--    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">-->
<!--    <style>-->
<!--        body {-->
<!--            background-color: #e9f7ef;-->
<!--        }-->
<!--        .form-label {-->
<!--            color: #28a745;-->
<!--        }-->
<!--        .btn-custom {-->
<!--            background-color: #28a745;-->
<!--            color: white;-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--    <div class="container mt-5">-->
<!--        <h1 class="text-center">Заполнение заказа</h1>-->
<!--        <form id="orderForm">-->
<!--            <input type="hidden" id="type" name="type" value="1">-->
<!--            <input type="hidden" id="tariff_code" name="tariff_code" value="137">-->

<!--            <div class="form-group">-->
<!--                <label for="from_city" class="form-label">Город отправления:</label>-->
<!--                <input type="text" class="form-control" id="from_city" name="from_city" required>-->
<!--            </div>-->
<!--            <div class="form-group">-->
<!--                <label for="from_address" class="form-label">Адрес отправления:</label>-->
<!--                <input type="text" class="form-control" id="from_address" name="from_address" required>-->
<!--            </div>-->
<!--            <div class="form-group">-->
<!--                <label for="to_city" class="form-label">Город назначения:</label>-->
<!--                <input type="text" class="form-control" id="to_city" name="to_city" required>-->
<!--            </div>-->
<!--            <div class="form-group">-->
<!--                <label for="to_address" class="form-label">Адрес назначения:</label>-->
<!--                <input type="text" class="form-control" id="to_address" name="to_address" required>-->
<!--            </div>-->
<!--            <div class="form-group">-->
<!--                <label for="recipient_name" class="form-label">Имя получателя:</label>-->
<!--                <input type="text" class="form-control" id="recipient_name" name="recipient_name" required>-->
<!--            </div>-->
<!--            <div class="form-group">-->
<!--                <label for="recipient_phone" class="form-label">Телефон получателя:</label>-->
<!--                <input type="text" class="form-control" id="recipient_phone" name="recipient_phone" required>-->
<!--            </div>-->
<!--            <div class="form-group">-->
<!--                <label for="sender_name" class="form-label">Имя отправителя:</label>-->
<!--                <input type="text" class="form-control" id="sender_name" name="sender_name" required>-->
<!--            </div>-->
<!--            <div class="form-group">-->
<!--                <label for="sender_company" class="form-label">Компания отправителя:</label>-->
<!--                <input type="text" class="form-control" id="sender_company" name="sender_company" required>-->
<!--            </div>-->
<!--            <div class="form-group">-->
<!--                <label for="sender_phone" class="form-label">Телефон отправителя:</label>-->
<!--                <input type="text" class="form-control" id="sender_phone" name="sender_phone" required>-->
<!--            </div>-->
<!--            <div class="form-group">-->
<!--                <label for="package_number" class="form-label">Номер упаковки:</label>-->
<!--                <input type="text" class="form-control" id="package_number" name="package_number" required>-->
<!--            </div>-->
<!--            <div class="form-group">-->
<!--                <label for="package_weight" class="form-label">Вес упаковки (г):</label>-->
<!--                <input type="number" class="form-control" id="package_weight" name="package_weight" required>-->
<!--            </div>-->
<!--            <div class="form-group">-->
<!--                <label for="package_length" class="form-label">Длина упаковки (см):</label>-->
<!--                <input type="number" class="form-control" id="package_length" name="package_length" required>-->
<!--            </div>-->
<!--            <div class="form-group">-->
<!--                <label for="package_width" class="form-label">Ширина упаковки (см):</label>-->
<!--                <input type="number" class="form-control" id="package_width" name="package_width" required>-->
<!--            </div>-->
<!--            <div class="form-group">-->
<!--                <label for="package_height" class="form-label">Высота упаковки (см):</label>-->
<!--                <input type="number" class="form-control" id="package_height" name="package_height" required>-->
<!--            </div>-->
<!--            <div class="form-group">-->
<!--                <label for="package_comment" class="form-label">Комментарий к упаковке:</label>-->
<!--                <input type="text" class="form-control" id="package_comment" name="package_comment">-->
<!--            </div>-->
<!--            <h2 class="text-center">Предметы</h2>-->
<!--            <div id="items">-->
<!--                <div class="item form-group">-->
<!--                    <label for="item_name" class="form-label">Название предмета:</label>-->
<!--                    <input type="text" class="form-control" id="item_name" name="item_name[]" required>-->
<!--                    <label for="ware_key" class="form-label">Идентификатор/артикул товара:</label>-->
<!--                    <input type="text" class="form-control" id="ware_key" name="ware_key[]" required>-->
<!--                    <label for="cost" class="form-label">Стоимость:</label>-->
<!--                    <input type="number" class="form-control" id="cost" name="cost[]" required>-->
<!--                    <label for="item_weight" class="form-label">Вес предмета (г):</label>-->
<!--                    <input type="number" class="form-control" id="item_weight" name="item_weight[]" required>-->
<!--                    <label for="amount" class="form-label">Количество:</label>-->
<!--                    <input type="number" class="form-control" id="amount" name="amount[]" required>-->
<!--                </div>-->
<!--            </div>-->
<!--            <button type="button" class="btn btn-custom" id="addItem">Добавить еще один предмет</button><br><br>-->
<!--            <button type="submit" class="btn btn-custom">Отправить заказ</button>-->
<!--        </form>-->
<!--    </div>-->

<!--    <script src="https://telegram.org/js/telegram-web-app.js"></script>-->
<!--    <script>-->
<!--        Telegram.WebApp.ready();-->

<!--        document.getElementById('orderForm').addEventListener('submit', function(event) {-->
<!--            event.preventDefault();-->

<!--            const formData = new FormData(event.target);-->
<!--            const formObject = Object.fromEntries(formData.entries());-->

<!--            const items = [];-->
<!--            document.querySelectorAll('#items .item').forEach(item => {-->
<!--                const itemData = {-->
<!--                    name: item.querySelector('[name="item_name[]"]').value,-->
<!--                    ware_key: item.querySelector('[name="ware_key[]"]').value,-->
<!--                    cost: item.querySelector('[name="cost[]"]').value,-->
<!--                    weight: item.querySelector('[name="item_weight[]"]').value,-->
<!--                    amount: item.querySelector('[name="amount[]"]').value-->
<!--                };-->
<!--                items.push(itemData);-->
<!--            });-->

<!--            formObject.items = items;-->
<!--            formObject.type = 1; // Установка дефолтного значения type-->
<!--            formObject.tariff_code = 137; // Установка дефолтного значения tariff_code-->

<!--            // Validate input before sending-->
<!--            if (validateInput(formObject)) {-->
<!--                Telegram.WebApp.sendData(JSON.stringify(formObject));-->
<!--            } else {-->
<!--                alert("Пожалуйста, заполните все обязательные поля корректно.");-->
<!--            }-->
<!--        });-->

<!--        document.getElementById('addItem').addEventListener('click', function() {-->
<!--            const newItem = document.querySelector('#items .item').cloneNode(true);-->
<!--            newItem.querySelectorAll('input').forEach(input => input.value = '');-->
<!--            document.getElementById('items').appendChild(newItem);-->
<!--        });-->

<!--        function validateInput(data) {-->
<!--            // Add your validation logic here-->
<!--            if (!data.from_city || !data.from_address || !data.to_city || !data.to_address || !data.recipient_name || !data.recipient_phone || !data.sender_name || !data.sender_company || !data.sender_phone || !data.package_number || !data.package_weight || !data.package_length || !data.package_width || !data.package_height) {-->
<!--                return false;-->
<!--            }-->

<!--            // Validate items-->
<!--            for (const item of data.items) {-->
<!--                if (!item.name || !item.ware_key || !item.cost || !item.weight || !item.amount) {-->
<!--                    return false;-->
<!--                }-->
<!--            }-->

<!--            return true;-->
<!--        }-->
<!--    </script>-->
<!--</body>-->
<!--</html>-->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Заполнение заказа</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #e9f7ef;
        }
        .form-label {
            color: #28a745;
        }
        .btn-custom {
            background-color: #28a745;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">Заполнение заказа</h1>
        <form id="orderForm">
            <input type="hidden" id="type" name="type" value="1">
            <input type="hidden" id="tariff_code" name="tariff_code" value="137">

            <div class="form-group">
                <label for="from_city" class="form-label">Город отправления:</label>
                <input type="text" class="form-control" id="from_city" name="from_city" value="Москва" required>
            </div>
            <div class="form-group">
                <label for="from_address" class="form-label">Адрес отправления:</label>
                <input type="text" class="form-control" id="from_address" name="from_address" value="левши, 1" required>
            </div>
            <div class="form-group">
                <label for="to_city" class="form-label">Город назначения:</label>
                <input type="text" class="form-control" id="to_city" name="to_city" value="Москва" required>
            </div>
            <div class="form-group">
                <label for="to_address" class="form-label">Адрес назначения:</label>
                <input type="text" class="form-control" id="to_address" name="to_address" value="левши, 5" required>
            </div>
            <div class="form-group">
                <label for="recipient_name" class="form-label">Имя получателя:</label>
                <input type="text" class="form-control" id="recipient_name" name="recipient_name" value="Иван" required>
            </div>
            <div class="form-group">
                <label for="recipient_phone" class="form-label">Телефон получателя:</label>
                <input type="text" class="form-control" id="recipient_phone" name="recipient_phone" value="89094659545" required>
            </div>
            <div class="form-group">
                <label for="sender_name" class="form-label">Имя отправителя:</label>
                <input type="text" class="form-control" id="sender_name" name="sender_name" value="Иван" required>
            </div>
            <div class="form-group">
                <label for="sender_company" class="form-label">Компания отправителя:</label>
                <input type="text" class="form-control" id="sender_company" name="sender_company" value="КОТ" required>
            </div>
            <div class="form-group">
                <label for="sender_phone" class="form-label">Телефон отправителя:</label>
                <input type="text" class="form-control" id="sender_phone" name="sender_phone" value="89094659543" required>
            </div>
            <div class="form-group">
                <label for="package_number" class="form-label">Номер упаковки:</label>
                <input type="text" class="form-control" id="package_number" name="package_number" value="1" required>
            </div>
            <div class="form-group">
                <label for="package_weight" class="form-label">Вес упаковки (г):</label>
                <input type="number" class="form-control" id="package_weight" name="package_weight" value="1000" required>
            </div>
            <div class="form-group">
                <label for="package_length" class="form-label">Длина упаковки (см):</label>
                <input type="number" class="form-control" id="package_length" name="package_length" value="12" required>
            </div>
            <div class="form-group">
                <label for="package_width" class="form-label">Ширина упаковки (см):</label>
                <input type="number" class="form-control" id="package_width" name="package_width" value="12" required>
            </div>
            <div class="form-group">
                <label for="package_height" class="form-label">Высота упаковки (см):</label>
                <input type="number" class="form-control" id="package_height" name="package_height" value="12" required>
            </div>
            <div class="form-group">
                <label for="package_comment" class="form-label">Комментарий к упаковке:</label>
                <input type="text" class="form-control" id="package_comment" name="package_comment" value="Handle with care">
            </div>
            <h2 class="text-center">Предметы</h2>
            <div id="items">
                <div class="item form-group">
                    <label for="item_name" class="form-label">Название предмета:</label>
                    <input type="text" class="form-control" id="item_name" name="item_name[]" value="Item 1" required>
                    <label for="ware_key" class="form-label">Идентификатор/артикул товара:</label>
                    <input type="text" class="form-control" id="ware_key" name="ware_key[]" value="key1" required>
                    <label for="cost" class="form-label">Стоимость:</label>
                    <input type="number" class="form-control" id="cost" name="cost[]" value="100" required>
                    <label for="item_weight" class="form-label">Вес предмета (г):</label>
                    <input type="number" class="form-control" id="item_weight" name="item_weight[]" value="500" required>
                    <label for="amount" class="form-label">Количество:</label>
                    <input type="number" class="form-control" id="amount" name="amount[]" value="1" required>
                </div>
            </div>
            <button type="button" class="btn btn-custom" id="addItem">Добавить еще один предмет</button><br><br>
            <button type="submit" class="btn btn-custom">Отправить заказ</button>
        </form>
    </div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        Telegram.WebApp.ready();

        document.getElementById('orderForm').addEventListener('submit', function(event) {
            event.preventDefault();

            const formData = new FormData(event.target);
            const formObject = {};
            formData.forEach((value, key) => {
                if (key.includes('item_name') || key.includes('ware_key') || key.includes('cost') || key.includes('item_weight') || key.includes('amount')) {
                    if (!formObject[key]) {
                        formObject[key] = [];
                    }
                    formObject[key].push(value);
                } else {
                    formObject[key] = value;
                }
            });

            const items = [];
            for (let i = 0; i < formObject['item_name[]'].length; i++) {
                const itemData = {
                    name: formObject['item_name[]'][i],
                    ware_key: formObject['ware_key[]'][i],
                    cost: parseInt(formObject['cost[]'][i]),
                    weight: parseInt(formObject['item_weight[]'][i]),
                    amount: parseInt(formObject['amount[]'][i])
                };
                items.push(itemData);
            }

            const orderData = {
                type_: parseInt(formObject.type),
                tariff_code: parseInt(formObject.tariff_code),
                from_city: formObject.from_city,
                from_address: formObject.from_address,
                to_city: formObject.to_city,
                to_address: formObject.to_address,
                recipient_name: formObject.recipient_name,
                recipient_phone: formObject.recipient_phone,
                sender_name: formObject.sender_name,
                sender_company: formObject.sender_company,
                sender_phone: formObject.sender_phone,
                package_number: formObject.package_number,
                package_weight: parseInt(formObject.package_weight),
                package_length: parseInt(formObject.package_length),
                package_width: parseInt(formObject.package_width),
                package_height: parseInt(formObject.package_height),
                package_comment: formObject.package_comment,
                item_names: formObject['item_name[]'],
                ware_keys: formObject['ware_key[]'],
                costs: formObject['cost[]'].map(Number),
                item_weights: formObject['item_weight[]'].map(Number),
                amounts: formObject['amount[]'].map(Number),
                items: items
            };

            // Validate input before sending
            if (validateInput(orderData)) {
                Telegram.WebApp.sendData(JSON.stringify(orderData));
            } else {
                alert("Пожалуйста, заполните все обязательные поля корректно.");
            }
        });

        document.getElementById('addItem').addEventListener('click', function() {
            const newItem = document.querySelector('#items .item').cloneNode(true);
            newItem.querySelectorAll('input').forEach(input => input.value = '');
            document.getElementById('items').appendChild(newItem);
        });

        function validateInput(data) {
            // Add your validation logic here
            if (!data.from_city || !data.from_address || !data.to_city || !data.to_address || !data.recipient_name || !data.recipient_phone || !data.sender_name || !data.sender_company || !data.sender_phone || !data.package_number || !data.package_weight || !data.package_length || !data.package_width || !data.package_height) {
                return false;
            }

            // Validate items
            for (const item of data.items) {
                if (!item.name || !item.ware_key || !item.cost || !item.weight || !item.amount) {
                    return false;
                }
            }

            return true;
        }
    </script>
</body>
</html>
